services:
  x-keeper:
    image: ${DOCKER_IMAGE:-ghcr.io/solidlime/x-keeper:latest}
    build:
      context: .
      dockerfile: Dockerfile

    container_name: x-keeper
    restart: unless-stopped

    env_file:
      - .env

    environment:
      PYTHONUTF8: "1"

    ports:
      - "0.0.0.0:${WEB_SETUP_PORT:-8989}:${WEB_SETUP_PORT:-8989}"

    volumes:
      # .env をマウントして Web UI からの設定変更をホストに反映
      - ./.env:/app/.env
      # メディア保存先。デフォルト save_path=./data → コンテナ内 /app/data に一致させる
      # NAS の場合は左辺を適宜変更 (例: /volume1/data:/app/data)
      - ./data:/app/data

    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
