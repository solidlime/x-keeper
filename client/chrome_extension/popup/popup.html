<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>x-keeper</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      width: 340px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 13px;
      background: #0f172a;
      color: #e2e8f0;
    }

    /* ヘッダー */
    header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 16px;
      background: #1e293b;
      border-bottom: 1px solid #334155;
    }
    header svg { flex-shrink: 0; }
    header h1 { font-size: 15px; font-weight: 700; color: #f1f5f9; }

    /* 接続状態バッジ */
    #status-badge {
      margin-left: auto;
      padding: 2px 8px;
      border-radius: 9999px;
      font-size: 11px;
      font-weight: 600;
    }
    #status-badge.online  { background: #166534; color: #86efac; }
    #status-badge.offline { background: #7f1d1d; color: #fca5a5; }

    /* メインコンテンツ */
    main { padding: 12px 16px; display: flex; flex-direction: column; gap: 12px; }

    /* セクションラベル */
    .section-label {
      font-size: 11px;
      font-weight: 600;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: .04em;
      margin-bottom: 6px;
    }

    /* サーバー URL */
    .input-row { display: flex; gap: 6px; }
    input[type="text"] {
      flex: 1;
      padding: 6px 10px;
      border: 1px solid #334155;
      border-radius: 6px;
      background: #1e293b;
      color: #f1f5f9;
      font-size: 12px;
      font-family: monospace;
      outline: none;
    }
    input[type="text"]:focus { border-color: #1d9bf0; }

    /* ボタン */
    button {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: opacity .15s;
      white-space: nowrap;
    }
    button:hover { opacity: 0.85; }
    button:disabled { opacity: 0.5; cursor: default; }
    .btn-primary   { background: #1d9bf0; color: #fff; }
    .btn-secondary { background: #334155; color: #e2e8f0; }
    .btn-danger    { background: #7f1d1d; color: #fca5a5; }
    .btn-success   { background: #166534; color: #86efac; }
    .btn-full      { width: 100%; text-align: center; }

    /* ギャラリーリンク */
    #btn-gallery {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      width: 100%;
      padding: 8px 12px;
    }

    /* オフラインキュー */
    #queue-section { display: none; }
    #queue-list {
      max-height: 72px;
      overflow-y: auto;
      padding: 6px 8px;
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 6px;
      margin-bottom: 6px;
    }
    #queue-list p {
      font-size: 11px;
      color: #94a3b8;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      line-height: 1.6;
    }
    .queue-actions { display: flex; gap: 6px; }

    /* サーバー処理キュー */
    #api-queue-section { display: none; }
    #api-queue-list {
      max-height: 120px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 3px;
      margin-bottom: 6px;
    }
    .api-queue-item {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 4px;
      font-size: 11px;
    }
    .api-queue-url {
      flex: 1;
      color: #94a3b8;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .api-queue-del {
      flex-shrink: 0;
      padding: 1px 6px;
      font-size: 10px;
      border-radius: 4px;
      background: #7f1d1d;
      color: #fca5a5;
      border: none;
      cursor: pointer;
    }
    .api-queue-del:hover { opacity: 0.8; }

    /* 区切り線 */
    hr { border: none; border-top: 1px solid #1e293b; }

    /* 履歴 */
    .history-row { display: flex; gap: 6px; }
    .history-row button { flex: 1; }

    /* キュー結果ログ */
    #result-log-section { display: none; }
    #result-log-list {
      max-height: 140px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    /* サーバー処理ログ */
    #server-log-section { display: none; }
    #server-log-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .log-entry {
      padding: 5px 8px;
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 4px;
      font-size: 11px;
      line-height: 1.5;
    }
    .log-entry .log-url {
      color: #94a3b8;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .log-entry .log-meta {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 2px;
    }
    .log-status {
      padding: 1px 6px;
      border-radius: 9999px;
      font-size: 10px;
      font-weight: 600;
      flex-shrink: 0;
    }
    .log-status.queued   { background: #1e3a5f; color: #60a5fa; }
    .log-status.offline  { background: #451a03; color: #fb923c; }
    .log-status.success  { background: #14532d; color: #86efac; }
    .log-status.failure  { background: #7f1d1d; color: #fca5a5; }
    .log-entry .log-time { color: #475569; font-size: 10px; }

    /* フッター */
    footer {
      padding: 8px 16px;
      font-size: 11px;
      color: #475569;
      text-align: center;
      border-top: 1px solid #1e293b;
    }
  </style>
</head>
<body>
  <header>
    <svg width="20" height="20" viewBox="0 0 24 24" fill="#1d9bf0">
      <path d="M12 16l-5-5 1.4-1.4 2.6 2.6V4h2v8.2l2.6-2.6L17 11l-5 5zm-6 4v-2h12v2H6z"/>
    </svg>
    <h1>x-keeper</h1>
    <span id="status-badge" class="offline">未接続</span>
  </header>

  <main>
    <!-- サーバー URL -->
    <div>
      <div class="section-label">サーバー URL</div>
      <div class="input-row">
        <input id="server-url" type="text" placeholder="http://192.168.1.10:8989">
        <button id="btn-test" class="btn-secondary">テスト</button>
        <button id="btn-save" class="btn-primary">保存</button>
      </div>
    </div>

    <!-- ギャラリーリンク -->
    <button id="btn-gallery" class="btn-secondary">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
        <path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14zm-9-7l-4 5h8l-3-4-2 2.5z"/>
      </svg>
      ギャラリーを開く
    </button>

    <hr>

    <!-- オフラインキュー -->
    <div id="queue-section">
      <div class="section-label">オフラインキュー <span id="queue-count"></span></div>
      <div id="queue-list"></div>
      <div class="queue-actions">
        <button id="btn-flush" class="btn-primary btn-full">今すぐ送信</button>
        <button id="btn-clear-queue" class="btn-danger">クリア</button>
      </div>
    </div>

    <!-- サーバー処理待ちキュー -->
    <div id="api-queue-section">
      <div class="section-label">処理待ちキュー <span id="api-queue-count"></span></div>
      <div id="api-queue-list"></div>
      <button id="btn-clear-api-queue" class="btn-danger btn-full">全件削除</button>
    </div>

    <!-- キュー済みアイテム (content.js がキューに追加した tweet / URL) -->
    <div id="queued-items-section" style="display:none">
      <div class="section-label">キュー済みアイテム <span id="queued-items-count"></span></div>
      <div id="queued-items-list"></div>
      <button id="btn-clear-queued" class="btn-danger btn-full" style="margin-top:6px">クリア</button>
    </div>

    <hr>

    <!-- 履歴 -->
    <div>
      <div class="section-label">ダウンロード履歴 (TMH互換)</div>
      <div id="history-count" style="font-size:11px;color:#64748b;margin-bottom:6px;min-height:14px;"></div>
      <div class="history-row">
        <button id="btn-export" class="btn-secondary">エクスポート</button>
        <button id="btn-import" class="btn-secondary">インポート</button>
      </div>
    </div>

    <hr>

    <!-- サーバー処理ログ (最新5件) -->
    <div id="server-log-section">
      <div class="section-label">最近の処理</div>
      <div id="server-log-list"></div>
    </div>

    <hr>

    <!-- キュー結果ログ -->
    <div id="result-log-section">
      <div class="section-label">キュー履歴 <span id="log-count"></span></div>
      <div id="result-log-list"></div>
    </div>
  </main>

  <footer>x-keeper Client v1.2.2</footer>

  <input id="import-file" type="file" accept=".json" style="display:none">
  <script src="popup.js"></script>
</body>
</html>
